datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id           Int      @id @default(autoincrement())
  email        String   @unique
  name         String? // ì„ íƒ
  passwordHash String // í•´ì‹œë§Œ ì €ì¥
  role         String? // ì„ íƒ
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  tasteRecords TasteRecord[]
  stays        Stay[] // ìœ ì €ê°€ ë¨¸ë¬¼ë €ë˜ ì¥ì†Œë“¤
  recommendations Recommendation[]
}

model TasteRecord {
  id     String @id @default(cuid())
  userId Int
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  title      String
  desc       String? // í•œ ì¤„ ì„¤ëª… (í”„ë¡ íŠ¸ì˜ captionì— í•´ë‹¹)
  content    String? // ìƒì„¸ ë‚´ìš©
  recordedAt DateTime? // ì‚¬ìš©ìê°€ ì„ íƒí•˜ëŠ” ë‚ ì§œ (ì—†ìœ¼ë©´ createdAt ê¸°ì¤€ìœ¼ë¡œ í™œìš©)
  category   String
  tagsJson   String? // íƒœê·¸ ë°°ì—´ì„ JSON ë¬¸ìì—´ë¡œ ì €ì¥ (DB ì¢…ë¥˜ì™€ ìƒê´€ì—†ì´ ì“°ê¸° ì‰½ê²Œ)

  thumb     String? // ì¸ë„¤ì¼ ì´ë¯¸ì§€ URL (ì§€ê¸ˆì€ ì•ˆ ì“°ë©´ null)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId, createdAt])
}

model Stay {
  id        Int      @id @default(autoincrement())

  userId    Int
  user      User     @relation(fields: [userId], references: [id])

  lat       Float
  lng       Float
  startTime DateTime
  endTime   DateTime

  // ğŸ”½ ì¹´ì¹´ì˜¤ ì¥ì†Œ + ì¹´í…Œê³ ë¦¬ ì •ë³´
  kakaoPlaceId      String?   // Kakao place_id
  categoryName      String?   // "ë¬¸í™”ì‹œì„¤ > ê·¹ì¥ > ì˜í™”ê´€" ì´ëŸ° ì›ë³¸ ë¬¸ìì—´
  categoryGroupCode String?   // CT1 / AT4 / CE7 / FD6 ...
  mappedCategory    String?   // 'ì˜í™”' | 'ê³µì—°' | 'ì „ì‹œ' | 'ë¬¸í™”ì‹œì„¤' | 'ê´€ê´‘ëª…ì†Œ' | 'ì¹´í˜' | 'ì‹ë‹¹' | 'ê¸°íƒ€'

  createdAt DateTime @default(now())

  @@index([userId, startTime])
  @@index([userId, mappedCategory])

  recommendations Recommendation[]
}

model Recommendation {
  id        Int      @id @default(autoincrement())

  userId    Int
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  // stayëŠ” ì˜µì…˜ìœ¼ë¡œ(ì—†ì–´ë„ ë¨)
  stayId    Int?
  stay      Stay?    @relation(fields: [stayId], references: [id], onDelete: Cascade)

  kakaoPlaceId      String
  name              String
  categoryName      String?
  categoryGroupCode String?
  mappedCategory    String   // 'ì˜í™”' | 'ê³µì—°' | ... | 'ì‹ë‹¹'

  x         Float
  y         Float
  score     Float

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // ê°™ì€ ìœ ì €ê°€ ê°™ì€ ì¥ì†Œì— ëŒ€í•œ ì¶”ì²œì´ stay ë‹¨ìœ„ë¡œ í•˜ë‚˜ì”©ë§Œ ìˆê²Œ í•˜ê³  ì‹¶ìœ¼ë©´:
  @@unique([userId, kakaoPlaceId, stayId])

  @@index([userId, score])
}
