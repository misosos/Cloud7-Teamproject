/**
 * âœ… ì¸ì¦(Auth) ë¼ìš°í„°
 * - ì´ íŒŒì¼ì€ ì¸ì¦ ê´€ë ¨ ì—”ë“œí¬ì¸íŠ¸(`/auth/*`)ë§Œ ë‹´ë‹¹í•©ë‹ˆë‹¤.
 * - ë³´í†µ `app.ts` ë˜ëŠ” `src/routes/index.ts`ì—ì„œ `app.use('/auth', authRouter)`ë¡œ ë§ˆìš´íŠ¸í•˜ì—¬ ì‚¬ìš©í•©ë‹ˆë‹¤.
 *
 * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 * ğŸ“¡ í”„ë¡ íŠ¸ì—”ë“œ ì—°ë™ ê·œì¹™(ì„¸ì…˜ ì¿ í‚¤ ê¸°ë°˜)
 * 1) ë°˜ë“œì‹œ `fetch/axios` í˜¸ì¶œ ì‹œ `credentials: 'include'`(axiosëŠ” `withCredentials: true`)ë¥¼ ì„¤ì •í•´ì•¼
 *    ë¸Œë¼ìš°ì €ê°€ `Set-Cookie`ë¥¼ ì €ì¥í•˜ê³  ì´í›„ ìš”ì²­ë§ˆë‹¤ ì„¸ì…˜ ì¿ í‚¤ë¥¼ ì „ì†¡í•©ë‹ˆë‹¤.
 * 2) ì„œë²„ CORSëŠ” `{ origin: ENV.CORS_ORIGIN, credentials: true }`ë¡œ ì„¤ì •ë˜ì–´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.
 * 3) ì„¸ì…˜ ì €ì¥ ì»¨ë²¤ì…˜(ê¶Œì¥): `req.session.user = { id, email, role }`
 *    - `/auth/me`ëŠ” ì´ ì„¸ì…˜ ê°’ì„ ì½ì–´ í˜„ì¬ ë¡œê·¸ì¸ ì‚¬ìš©ìë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
 * 4) ê°œë°œ ì¤‘ ê°™ì€ ë„ë©”ì¸ì´ ì•„ë‹ˆë¼ë©´(ì˜ˆ: Vite http://localhost:5173 â†” API http://localhost:3000),
 *    ì¿ í‚¤ ë„ë©”ì¸/í¬íŠ¸ê°€ ë‹¬ë¼ì„œ ì¸ì¦ì´ ì•ˆ ë˜ëŠ” ì¼ì´ ë§ìŠµë‹ˆë‹¤. CORSì™€ `credentials` ì„¤ì •ì„ ê¼­ ë§ì¶”ì„¸ìš”.
 *
 * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 * ğŸ“˜ ì—”ë“œí¬ì¸íŠ¸ ê°œìš”
 * - GET   /auth/me       : í˜„ì¬ ë¡œê·¸ì¸í•œ ì‚¬ìš©ì ì¡°íšŒ (ì„¸ì…˜ í™•ì¸)
 * - POST  /auth/register : íšŒì›ê°€ì… ì²˜ë¦¬(ì„±ê³µ ì‹œ ì„¸ì…˜ì— user ì €ì¥)
 * - POST  /auth/login    : ë¡œê·¸ì¸ ì²˜ë¦¬(ì„±ê³µ ì‹œ ì„¸ì…˜ì— user ì €ì¥)
 * - POST  /auth/logout   : ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬(ì„¸ì…˜ íŒŒê¸° + ì¿ í‚¤ ì œê±°)
 *
 * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 * ğŸ”’ ë³´ì•ˆ/ìš´ì˜ íŒ
 * - `/auth/me`ëŠ” ì‹¤ì œ ì„œë¹„ìŠ¤ì—ì„œëŠ” ë³´í˜¸ ë¼ìš°íŠ¸(ì˜ˆ: `authRequired`)ë¥¼ ê¶Œì¥í•©ë‹ˆë‹¤.
 * - `/auth/logout`ëŠ” ë©±ë“±ì„±(idempotent)ì„ ìœ„í•´ POST ì‚¬ìš©. CSRF ëŒ€ë¹„ëŠ” SameSite, CSRF í† í° ë“± ì ìš© ê³ ë ¤.
 * - ë¹„ë°€ë²ˆí˜¸ëŠ” DBì— í‰ë¬¸ ì €ì¥ ê¸ˆì§€(ì´ë¯¸ ì„œë¹„ìŠ¤ ë ˆì´ì–´ì—ì„œ bcrypt í•´ì‹œ ì‚¬ìš©).
 * - ì—ëŸ¬ ë©”ì‹œì§€ëŠ” ê³¼ë„í•œ ì •ë³´ ë…¸ì¶œ ê¸ˆì§€(ì¡´ì¬ ì—¬ë¶€, í•´ì‹œ ë¹„êµ ì‹¤íŒ¨ ì´ìœ  ë“±ì€ í†µì¼ëœ ë©”ì‹œì§€ë¡œ).
 *
 * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 * ğŸ§ª ë¹ ë¥¸ í…ŒìŠ¤íŠ¸(curl)
 * 1) íšŒì›ê°€ì…:
 *    curl -i -c cookies.txt -H "Content-Type: application/json" \
 *      -d '{"email":"a@b.com","password":"123456","name":"í™ê¸¸ë™"}' \
 *      http://localhost:3000/auth/register
 * 2) ë¡œê·¸ì¸:
 *    curl -i -b cookies.txt -c cookies.txt -H "Content-Type: application/json" \
 *      -d '{"email":"a@b.com","password":"123456"}' \
 *      http://localhost:3000/auth/login
 * 3) ì„¸ì…˜ í™•ì¸:
 *    curl -i -b cookies.txt http://localhost:3000/auth/me
 * 4) ë¡œê·¸ì•„ì›ƒ:
 *    curl -i -b cookies.txt -X POST http://localhost:3000/auth/logout
 *
 * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 * ğŸ§° í”„ë¡ íŠ¸ ì˜ˆì‹œ(axios)
 *   const api = axios.create({ baseURL: import.meta.env.VITE_API_BASE_URL, withCredentials: true });
 *   await api.post('/auth/login', { email, password }); // ì¿ í‚¤ ì €ì¥ë¨
 *   const { data } = await api.get('/auth/me');         // ì„¸ì…˜ ì‚¬ìš©ì ì¡°íšŒ
 */

// Express ë¼ìš°í„° ìœ í‹¸
import { Router } from 'express';

// ì»¨íŠ¸ë¡¤ëŸ¬: ì‹¤ì œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì€ ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ì²˜ë¦¬í•©ë‹ˆë‹¤.
// - me      : ì„¸ì…˜ì—ì„œ ì‚¬ìš©ì ì •ë³´ë¥¼ ì½ì–´ ë°˜í™˜
// - register: íšŒì›ê°€ì… ì²˜ë¦¬ ë° ì„¸ì…˜ ì €ì¥
// - login   : ìê²© ì¦ëª… ê²€ì¦ í›„ `req.session.user = {...}` ì €ì¥
// - logout  : ì„¸ì…˜ íŒŒê´´ ë° ì¿ í‚¤ ì œê±°
import { me, register, login, logout } from '../controllers/auth.controller';

// (ì„ íƒ) ë¡œê·¸ì¸ ì´í›„ ë³´í˜¸ê°€ í•„ìš”í•˜ë©´ ì•„ë˜ ë¯¸ë“¤ì›¨ì–´ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”.
// TODO: ë¡œê·¸ì¸ ì—°ë™ í›„ `/auth/me` ë“± ë³´í˜¸ê°€ í•„ìš”í•œ ê²½ë¡œì— ì ìš©
// import { authRequired } from '../middlewares/authRequired';

const router = Router();

/**
 * GET /auth/me
 * - í˜„ì¬ ë¡œê·¸ì¸í•œ ì‚¬ìš©ìì˜ ì„¸ì…˜ ì •ë³´ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
 * - ê¸°ë³¸ ìƒíƒœ: ê³µê°œ ì—”ë“œí¬ì¸íŠ¸(ì´ˆê¸° ì„¸íŒ…). ì‹¤ì œ ì„œë¹„ìŠ¤ì—ì„œëŠ” ë³´í˜¸ ë¼ìš°íŠ¸ ê¶Œì¥.
 *   â†’ ì ìš© ì˜ˆì‹œ: `router.get('/me', authRequired, me);`
 *
 * âœ… ì‘ë‹µ(ì˜ˆì‹œ)
 *   200 OK  { ok: true, user: { id, email, name?, role? } }  // ë¡œê·¸ì¸ë¨
 *   200 OK  { ok: true, user: null }                          // ë¡œê·¸ì¸ ì•ˆ ë¨(ì´ˆê¸° ê³µê°œ)
 *   401     { ok: false, message: 'UNAUTHORIZED' }            // ë³´í˜¸ ë¼ìš°íŠ¸ ì ìš© ì‹œ
 *
 * âš ï¸ ì£¼ì˜
 * - í”„ë¡ íŠ¸ëŠ” `withCredentials: true`ê°€ ì„¤ì •ëœ ì¸ìŠ¤í„´ìŠ¤ë¡œ í˜¸ì¶œí•´ì•¼ ì„¸ì…˜ ì¿ í‚¤ë¥¼ ë³´ëƒ…ë‹ˆë‹¤.
 */
router.get('/me', me);

/**
 * POST /auth/register
 * - íšŒì›ê°€ì…: ë³¸ë¬¸ { email, password, name? }
 * - ì„±ê³µ ì‹œ ì„¸ì…˜ì— userë¥¼ ì €ì¥í•˜ê³  ì‚¬ìš©ì ì •ë³´ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
 *
 * âœ… ìš”ì²­ ë°”ë””
 *   { "email": "a@b.com", "password": "123456", "name": "í™ê¸¸ë™" }
 *
 * âœ… ì‘ë‹µ(ì˜ˆì‹œ)
 *   201 Created { ok: true, user: { id, email, name?, role? } }
 *   400 Bad Request { ok: false, message: 'INVALID_EMAIL|WEAK_PASSWORD|...'}
 *   409 Conflict    { ok: false, message: 'EMAIL_EXISTS' }
 *
 * ğŸ§ª curl
 *   curl -i -c cookies.txt -H "Content-Type: application/json" \
 *     -d '{"email":"a@b.com","password":"123456","name":"í™ê¸¸ë™"}' \
 *     http://localhost:3000/auth/register
 */
router.post('/register', register);

/**
 * POST /auth/login
 * - ë¡œê·¸ì¸: ë³¸ë¬¸ { email, password }
 * - ì„±ê³µ ì‹œ ì„¸ì…˜ì— user ì €ì¥ í›„ ì‚¬ìš©ì ì •ë³´ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
 *
 * âœ… ìš”ì²­ ë°”ë””
 *   { "email": "a@b.com", "password": "123456" }
 *
 * âœ… ì‘ë‹µ(ì˜ˆì‹œ)
 *   200 OK { ok: true, user: { id, email, name?, role? } }
 *   401    { ok: false, message: 'INVALID_CREDENTIALS' }
 *
 * âš ï¸ ì£¼ì˜
 * - í”„ë¡ íŠ¸ì—ì„œ ë°˜ë“œì‹œ `withCredentials: true`(axios) ë˜ëŠ” `credentials: 'include'`(fetch)ë¥¼ ì‚¬ìš©í•´ì•¼
 *   ì¿ í‚¤ê°€ ì €ì¥ë˜ì–´ ì´í›„ `/auth/me` í˜¸ì¶œ ì‹œ ì„¸ì…˜ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
 *
 * ğŸ§ª curl
 *   curl -i -b cookies.txt -c cookies.txt -H "Content-Type: application/json" \
 *     -d '{"email":"a@b.com","password":"123456"}' \
 *     http://localhost:3000/auth/login
 */
router.post('/login', login);

/**
 * POST /auth/logout
 * - í˜„ì¬ ì„¸ì…˜ì„ íŒŒê¸°(destroy)í•˜ê³  ì¿ í‚¤ë¥¼ ì œê±°í•©ë‹ˆë‹¤.
 * - í”„ë¡ íŠ¸ëŠ” ì„±ê³µ ì‘ë‹µì„ ë°›ìœ¼ë©´ í´ë¼ì´ì–¸íŠ¸ ìƒíƒœ(Zustandì˜ user ë“±)ë„ ì´ˆê¸°í™”í•˜ì„¸ìš”.
 *
 * âœ… ì‘ë‹µ(ì˜ˆì‹œ)
 *   200 OK { ok: true }
 *
 * ğŸ§ª curl
 *   curl -i -b cookies.txt -X POST http://localhost:3000/auth/logout
 */
router.post('/logout', logout);

export default router;